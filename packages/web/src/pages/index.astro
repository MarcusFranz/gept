---
// packages/web/src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import { HomePage } from '../components/HomePage';
import { activeTradesRepo, userRepo } from '../lib/repositories';

// Check auth
if (!Astro.locals.user) {
  return Astro.redirect('/login');
}

const user = Astro.locals.user;

// Fetch user data
const userData = await userRepo.findOrCreate(user.id, user.email);
const trades = await activeTradesRepo.findByUserId(user.id);
---

<Layout title="GePT - My Trades">
  <HomePage
    client:load
    user={{ id: user.id, email: user.email }}
    initialTrades={trades}
  />
</Layout>
